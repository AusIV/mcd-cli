#!/usr/bin/env bash
### mcd-dai -- Vat Dai balances
### Usage: mcd dai [<command>]
###
### Commands: balance [<address>]
###           supply
###           join <wad>
###           exit <wad>
###
### With `balance' get the vat balance for a given address (default: ETH_FROM).
### With `supply' get the total dai supply (vat.debt).
### With `join' exchange DSToken Dai for Vat Dai.
### With `exit' exchange Vat Dai for DSToken Dai.
###
### Example: mcd dai balance
###          mcd dai join 72.50
set -e

case $1 in
  balance) {
    urn=$(seth --to-word ${2:-$ETH_FROM})
    bal=$(seth call $MCD_VAT 'dai(bytes32)(uint256)' "$urn")
    echo $(mcd --to-rad $bal)
  };;
  supply) {
    mcd debt
  };;
  join) {
    urn=$(seth --to-word $ETH_FROM)
    wad=$(seth --to-word $(seth --to-wei $2 eth))
    (set -x; seth send $MCD_JOIN_DAI "join(bytes32, uint256)" $urn $wad)
  };;
  exit) {
    guy=$(seth --to-address $ETH_FROM)
    wad=$(seth --to-word $(seth --to-wei $2 eth))
    (set -x; seth send $MCD_JOIN_DAI "exit(address, uint256)" $guy $wad)
  };;
  *) {
    mcd help dai
  }
esac
